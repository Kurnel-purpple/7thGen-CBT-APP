<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="client-id" content="seatos">
    <title>Exam In Progress - CBT Exam</title>
    <link rel="manifest" href="../manifest.json">
    <link rel="stylesheet" href="../css/main.css">
    <link rel="stylesheet" href="../css/exam.css">
</head>

<body>
    <div class="exam-container">
        <!-- Sidebar -->
        <aside class="exam-sidebar">
            <div class="sidebar-header">
                <div class="student-info" id="student-name">Student Name</div>
                <div class="exam-info" id="exam-subject">Subject</div>
            </div>

            <div class="palette-container">
                <p style="margin-bottom: 10px; font-size: 0.8rem; color: #666;">Question Palette:</p>
                <div class="question-grid" id="question-palette">
                    <!-- Dynamic Buttons -->
                </div>
            </div>

            <div class="sidebar-footer">
                <div
                    style="display: flex; justify-content: space-around; font-size: 0.75rem; color: #666; margin-bottom: 10px;">
                    <div><span
                            style="width:10px; height:10px; background:var(--primary-color); display:inline-block; border-radius:50%;"></span>
                        Current</div>
                    <div><span
                            style="width:10px; height:10px; background:var(--primary-color); opacity:0.7; display:inline-block; border-radius:50%;"></span>
                        Answered</div>
                    <div><span
                            style="width:10px; height:10px; border:1px solid #ccc; display:inline-block; border-radius:50%;"></span>
                        Unseen</div>
                </div>
                <!-- Submit Button moved to bottom right usually, but can be here too. Let's keep Submit in main footer -->
            </div>
        </aside>

        <!-- Main Content -->
        <main class="exam-main">
            <header class="exam-header">
                <h2 id="exam-title">Exam Title</h2>
                <div class="timer-display" id="timer">00:00:00</div>
            </header>

            <div class="question-area" id="question-area">
                <div class="question-card">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 15px;">
                        <span style="color: var(--primary-color); font-weight: bold;">Question <span
                                id="q-current-num">1</span> / <span id="q-total-num">10</span></span>
                        <label style="cursor: pointer; display: flex; align-items: center; font-size: 0.9rem;">
                            <input type="checkbox" id="flag-checkbox" style="margin-right: 5px;"> Flag for review
                        </label>
                    </div>

                    <div class="q-text-display" id="q-text">
                        Loading question...
                    </div>

                    <div class="options-list" id="q-options">
                        <!-- Options go here -->
                    </div>
                </div>
            </div>

            <footer class="exam-footer">
                <button class="btn" id="prev-btn">Previous</button>
                <button class="btn btn-primary" id="submit-btn" style="background: var(--success-color);">Submit
                    Exam</button>
                <button class="btn btn-primary" id="next-btn">Next</button>
            </footer>
        </main>
    </div>

    <!-- Submit Modal -->
    <div class="modal" id="submit-modal">
        <div class="modal-content">
            <h3>Submit Exam?</h3>
            <p>Are you sure you want to finish?</p>
            <div class="modal-summary">
                <p>Answered: <strong id="summary-answered">0</strong></p>
                <p>Unanswered: <strong id="summary-unanswered" style="color: var(--accent-color);">0</strong></p>
                <p>Flagged: <strong id="summary-flagged">0</strong></p>
            </div>
            <div style="display: flex; justify-content: space-between; gap: 10px;">
                <button class="btn btn-outline"
                    onclick="document.getElementById('submit-modal').style.display='none'">Return to Exam</button>
                <button class="btn btn-primary" style="background: var(--success-color);"
                    onclick="takeExam.confirmSubmit()">Yes, Submit</button>
            </div>
        </div>
    </div>

    <!-- Result Modal -->
    <div id="result-modal" class="modal"
        style="display: none; z-index: 10001; align-items: center; justify-content: center; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5);">
        <div class="modal-content"
            style="text-align: center; padding: 30px; max-width: 400px; width: 90%; background: var(--card-bg); border-radius: 12px; box-shadow: 0 10px 40px rgba(0,0,0,0.2);">
            <div id="result-icon" style="font-size: 4rem; margin-bottom: 20px;">ðŸŽ‰</div>
            <h3 id="result-title" style="margin-bottom: 10px; font-size: 1.5rem; color: var(--text-color);">Exam
                Submitted!</h3>
            <p id="result-message" style="margin-bottom: 25px; color: var(--light-text); line-height: 1.5;">You have
                successfully completed the exam.</p>

            <div id="result-score-container"
                style="background: var(--inner-bg); padding: 20px; border-radius: 12px; margin-bottom: 25px;">
                <div
                    style="font-size: 0.85rem; font-weight: 600; letter-spacing: 1px; color: var(--light-text); margin-bottom: 5px; text-transform: uppercase;">
                    Your Score</div>
                <div id="result-score"
                    style="font-size: 3rem; font-weight: 800; color: var(--primary-color); line-height: 1;">0%</div>
                <div id="result-points"
                    style="font-size: 1rem; color: var(--text-color); margin-top: 5px; opacity: 0.8;">0 / 0 Points</div>
                <div id="result-status"
                    style="margin-top: 10px; font-weight: bold; text-transform: uppercase; font-size: 1.1rem; padding: 5px 15px; border-radius: 20px; display: inline-block; background: rgba(0,0,0,0.05);">
                    PASSED</div>
            </div>

            <button class="btn btn-primary" onclick="window.location.href='student-dashboard.html'"
                style="width: 100%; padding: 14px; font-size: 1.1rem; border-radius: 8px; font-weight: 600;">Return to
                Dashboard</button>
        </div>
    </div>

    </div>

    <!-- Alert Modal -->
    <div id="alert-modal" class="modal"
        style="display: none; z-index: 10002; align-items: center; justify-content: center; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5);">
        <div class="modal-content"
            style="max-width: 400px; width: 90%; text-align: center; background: var(--card-bg); padding: 25px; border-radius: 12px; box-shadow: 0 10px 40px rgba(0,0,0,0.2);">
            <h3 id="alert-title" style="margin-bottom: 10px; color: var(--text-color);">Notice</h3>
            <p id="alert-message" style="margin-bottom: 20px; color: var(--light-text); line-height: 1.5;"></p>
            <button class="btn btn-primary" id="alert-btn"
                onclick="document.getElementById('alert-modal').style.display='none'"
                style="min-width: 100px;">OK</button>
        </div>
    </div>
    <script src="https://unpkg.com/pocketbase@0.21.0/dist/pocketbase.umd.js"></script>
    <!-- Configuration System -->
    <script type="module">
        import { initConfig } from '../config/index.js';
        // Initialize configuration before other scripts
        await initConfig();
    </script>


    <script src="../js/idb.js"></script>
    <script src="../js/utils.js"></script>
    <script src="../js/dataService.js"></script>
    <script src="../js/timer.js"></script>
    <script src="../../node_modules/fabric/dist/index.js"></script>
    <script src="../js/fabricWordProcessor.js"></script>
    <script src="../js/takeExam.js"></script>
</body>

</html>